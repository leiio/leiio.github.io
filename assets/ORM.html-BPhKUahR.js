import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as c,o as i,c as u,b as n,a,w as p,d as s,f as o}from"./app-BGG14fOW.js";const r={},k=n("h1",{id:"orm",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#orm","aria-hidden":"true"},"#"),s(" ORM")],-1),d={class:"table-of-contents"},m=n("h2",{id:"flag",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#flag","aria-hidden":"true"},"#"),s(" Flag")],-1),v=n("blockquote",null,[n("p",null,"对象关系映射（Object Relational Mapping，简称ORM）是通过使用描述对象和数据库之间映射的元数据， 将面向对象语言程序中的对象自动持久化到关系数据库中。")],-1),b={href:"https://sourceforge.net/projects/jpox",target:"_blank",rel:"noopener noreferrer"},g={href:"https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-reference-type-conversions.html",target:"_blank",rel:"noopener noreferrer"},h={href:"http://www.squirrelsql.org",target:"_blank",rel:"noopener noreferrer"},f={href:"http://java-source.net/open-source/sql-clients",target:"_blank",rel:"noopener noreferrer"},_={href:"https://github.com/jOOQ",target:"_blank",rel:"noopener noreferrer"},q={href:"https://github.com/querydsl/querydsl",target:"_blank",rel:"noopener noreferrer"},y={href:"https://github.com/BatooOrg/BatooJPA",target:"_blank",rel:"noopener noreferrer"},j={href:"https://github.com/aaberg/sql2o",target:"_blank",rel:"noopener noreferrer"},S={href:"https://github.com/jdbi/jdbi",target:"_blank",rel:"noopener noreferrer"},w={href:"https://github.com/eclipse-ee4j/eclipselink",target:"_blank",rel:"noopener noreferrer"},x={href:"https://github.com/datanucleus",target:"_blank",rel:"noopener noreferrer"},C={href:"https://github.com/apache/openjpa",target:"_blank",rel:"noopener noreferrer"},L={href:"https://github.com/spring-projects/spring-data-jdbc",target:"_blank",rel:"noopener noreferrer"},T={href:"https://github.com/apache/commons-dbutils",target:"_blank",rel:"noopener noreferrer"},M={href:"https://github.com/ejlchina/bean-searcher",target:"_blank",rel:"noopener noreferrer"},A={href:"https://github.com/speedment",target:"_blank",rel:"noopener noreferrer"},E={href:"https://github.com/apache/calcite",target:"_blank",rel:"noopener noreferrer"},R={href:"https://github.com/itfsw/mybatis-generator-plugin",target:"_blank",rel:"noopener noreferrer"},I={href:"https://github.com/SanjinKurelic/MVCGenerator",target:"_blank",rel:"noopener noreferrer"},Q={href:"https://github.com/jeddict/jeddict",target:"_blank",rel:"noopener noreferrer"},O={href:"https://codverter.com/src/sqltoclass",target:"_blank",rel:"noopener noreferrer"},B={href:"https://gitee.com/l0km/sql2java",target:"_blank",rel:"noopener noreferrer"},D={href:"https://sourceforge.net/projects/sql2java",target:"_blank",rel:"noopener noreferrer"},U={href:"https://github.com/xgp/sql2java",target:"_blank",rel:"noopener noreferrer"},F={href:"https://github.com/blinkfox/zealot",target:"_blank",rel:"noopener noreferrer"},N={href:"https://github.com/vipbooks/TableGo",target:"_blank",rel:"noopener noreferrer"},H={href:"https://github.com/jahlborn/sqlbuilder",target:"_blank",rel:"noopener noreferrer"},P={href:"https://github.com/pingfangushi/screw",target:"_blank",rel:"noopener noreferrer"},z={href:"https://github.com/apache/shardingsphere",target:"_blank",rel:"noopener noreferrer"},J={href:"https://github.com/apache/shardingsphere-elasticjob",target:"_blank",rel:"noopener noreferrer"},V={href:"https://github.com/brettwooldridge/HikariCP",target:"_blank",rel:"noopener noreferrer"},G={href:"https://github.com/alibaba/druid",target:"_blank",rel:"noopener noreferrer"},Y={href:"https://developer.aliyun.com/article/1000273",target:"_blank",rel:"noopener noreferrer"},W=n("p",null,[n("strong",null,"Transaction")],-1),K={href:"https://github.com/codingapi/tx-lcn",target:"_blank",rel:"noopener noreferrer"},Z={href:"https://github.com/seata/seata",target:"_blank",rel:"noopener noreferrer"},X={href:"https://github.com/changmingxie/tcc-transaction",target:"_blank",rel:"noopener noreferrer"},$={href:"https://github.com/QNJR-GROUP/EasyTransaction",target:"_blank",rel:"noopener noreferrer"},nn={href:"https://github.com/liuyangming/ByteTCC",target:"_blank",rel:"noopener noreferrer"},sn={href:"https://github.com/wchswchs/Hulk",target:"_blank",rel:"noopener noreferrer"},an={href:"https://github.com/atomikos/transactions-essentials",target:"_blank",rel:"noopener noreferrer"},tn=o('<h2 id="jdbc驱动" tabindex="-1"><a class="header-anchor" href="#jdbc驱动" aria-hidden="true">#</a> JDBC驱动</h2><p><strong>注意使用的JDBC驱动</strong></p><ul><li><code>com.mysql.jdbc.Driver</code>是<code>mysql-connector-java 5</code>中的，不再推荐使用</li><li><code>com.mysql.cj.jdbc.Driver</code>是<code>mysql-connector-java 6</code>中的</li></ul><blockquote><p>如果<code>mysql-connector-java</code>用的<code>6.0</code>以上的，但是你的<code>driver</code>用的还是<code>com.mysql.jdbc.Driver</code>，就会报错</p></blockquote><p><strong>URL及参数</strong></p>',5),en={href:"https://mysqlconnector.net/connection-options",target:"_blank",rel:"noopener noreferrer"},pn=o('<blockquote><p><code>jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;useSSL=false</code><code>&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;zeroDateTimeBehavior=convertToNull&amp;serverTimezone=Asia/Shanghai</code></p></blockquote><table><thead><tr><th>参数名称</th><th>参数说明</th><th>缺省值</th><th>最低版本要求</th></tr></thead><tbody><tr><td>user</td><td>数据库用户名（用于连接数据库）</td><td></td><td>所有版本</td></tr><tr><td>password</td><td>用户密码（用于连接数据库）</td><td></td><td>所有版本</td></tr><tr><td>useUnicode</td><td>是否使用Unicode字符集，使用参数characterEncoding，本参数值必须设置为true</td><td>FALSE</td><td>1.1g</td></tr><tr><td>characterEncoding</td><td>当useUnicode设置为true时，指定字符编码。比如可设置为gb2312或gbk、UTF-8</td><td>FALSE</td><td>1.1g</td></tr><tr><td>autoReconnect</td><td>当数据库连接异常中断时，是否自动重新连接？</td><td>FALSE</td><td>1.1</td></tr><tr><td>autoReconnectForPools</td><td>是否使用针对数据库连接池的重连策略</td><td>FALSE</td><td>3.1.3</td></tr><tr><td>failOverReadOnly</td><td>自动重连成功后，连接是否设置为只读？</td><td>TRUE</td><td>3.0.12</td></tr><tr><td>maxReconnects</td><td>autoReconnect设置为true时，重试连接的次数</td><td>3</td><td>1.1</td></tr><tr><td>initialTimeout</td><td>autoReconnect设置为true时，两次重连之间的时间间隔，单位：秒</td><td>2</td><td>1.1</td></tr><tr><td>connectTimeout</td><td>和数据库服务器建立socket连接时的超时，单位：毫秒</td><td>0</td><td>3.0.1</td></tr><tr><td>socketTimeout</td><td>socket操作（读写）超时，单位：毫秒。 0表示永不超时</td><td>0</td><td>3.0.1</td></tr><tr><td>useSSL</td><td>是否进行ssl连接</td><td></td><td></td></tr><tr><td>zeroDateTimeBehavior</td><td>把零值日期转换为<code>null</code></td><td></td><td></td></tr><tr><td>serverTimezone</td><td><code>GMT%2B8</code> <code>%2B</code>是<code>+</code>的转义字符,其实就是<code>GMT+8</code>（&#39;+8:00&#39;）,代表东八区<code>Asia/Shanghai</code></td><td></td><td></td></tr></tbody></table><ul><li><code>useTimeZone</code> 为true时，会开启服务器和客户端之间的时区转换，只有<code>useLegacyDatetimeCode = true</code>时才回生效</li><li><code>useLegacyDatetimeCode</code> 默认为true，为false时: <code>useTimezone</code>, <code>useJDBCCompliantTimezoneShift</code>, <code>useGmtMillisForDatetimes</code>, <code>useFastDateParsing</code> 这几个参数都会无效</li></ul><h2 id="mybatis" tabindex="-1"><a class="header-anchor" href="#mybatis" aria-hidden="true">#</a> Mybatis</h2>',4),on={href:"https://github.com/mybatis",target:"_blank",rel:"noopener noreferrer"},cn={href:"https://mybatis.org/mybatis-3/zh/dynamic-sql.html",target:"_blank",rel:"noopener noreferrer"},ln={href:"https://github.com/pagehelper/Mybatis-PageHelper",target:"_blank",rel:"noopener noreferrer"},un={href:"https://github.com/baomidou/mybatis-plus",target:"_blank",rel:"noopener noreferrer"},rn={href:"https://github.com/davidfantasy/mybatis-plus-generator-ui",target:"_blank",rel:"noopener noreferrer"},kn={href:"https://github.com/alexdyysp/MybatisHandBook",target:"_blank",rel:"noopener noreferrer"},dn={href:"https://cloud.tencent.com/developer/article/1769767",target:"_blank",rel:"noopener noreferrer"},mn={href:"https://cofcool.github.io/tech/2018/06/20/mybatis-sourcecode-1",target:"_blank",rel:"noopener noreferrer"},vn={href:"https://my.oschina.net/u/2326864/blog/1622990",target:"_blank",rel:"noopener noreferrer"},bn={href:"https://blog.csdn.net/weixin_43794897/article/details/88534992",target:"_blank",rel:"noopener noreferrer"},gn=o(`<p><strong>trim标签</strong></p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>prefix</td><td>在条件语句前需要加入的内容</td></tr><tr><td>suffix</td><td>在条件语句后需要加入的内容</td></tr><tr><td>prefixOverrides</td><td>覆盖/去除sql语句前面的指定内容</td></tr><tr><td>suffixOverrides</td><td>覆盖/去除sql语句后面的指定内容</td></tr></tbody></table><ul><li>示例</li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectSelective<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.util.Map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM user
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>WHERE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AND|OR<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id != null and id.trim() != &#39;&#39; <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        id = #{id} AND
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name != null and name.trim() != &#39;&#39; <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        name = #{name} AND
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 等同于以下方式 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectSelective<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.util.Map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM user
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id != null and id.trim() != &#39;&#39; <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name != null and name.trim() != &#39;&#39; <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        AND name = #{name} 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Oracle 的in query list 的大小要不大于1000</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> taskLists <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
taskLists<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>tasksToArchive<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> times <span class="token operator">=</span> tasksToArchive<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> tasksToArchive<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">:</span> <span class="token punctuation">(</span>tasksToArchive<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IAccountingTask</span><span class="token punctuation">&gt;</span></span> tasksToArchiveList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IAccountingTask</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>taskLists <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>taskLists<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> times<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">IAccountingTask</span><span class="token punctuation">&gt;</span></span> tempList<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">&lt;=</span> taskLists<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tempList <span class="token operator">=</span> persistenceManager<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token class-name">AccountingTask</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                    taskLists<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            tempList <span class="token operator">=</span> persistenceManager<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token class-name">AccountingTask</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                    taskLists<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> taskLists<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tasksToArchiveList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>tempList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TransactRepViewModel</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TransactRepViewModel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> partitions <span class="token operator">=</span> <span class="token class-name">ListUtils</span><span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span>clientIdList<span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> partition <span class="token operator">:</span> partitions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>yourRepo<span class="token punctuation">.</span><span class="token function">findByClientIdList</span><span class="token punctuation">(</span>partition<span class="token punctuation">,</span> startDate<span class="token punctuation">,</span> endDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sessionIds<span class="token punctuation">&quot;</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>session_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(<span class="token punctuation">&quot;</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>,<span class="token punctuation">&quot;</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index == 0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      session_id in (
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 多个if判断原因：
           sql in 最大只有1000个参数。
           foreach 只去掉了最后一个‘,’
           数据库表中sessionId是非空设置
    --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index != 0 and index % 500 == 0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      &#39;&#39; ) or session_id in (
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    #{session_id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index == sessionIds.size - 1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      )
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hibernate" tabindex="-1"><a class="header-anchor" href="#hibernate" aria-hidden="true">#</a> Hibernate</h2>`,8),hn={href:"https://github.com/hibernate",target:"_blank",rel:"noopener noreferrer"},fn={href:"https://github.com/vladmihalcea/hypersistence-optimizer",target:"_blank",rel:"noopener noreferrer"},_n={href:"https://github.com/jeecgboot/MiniDao",target:"_blank",rel:"noopener noreferrer"},qn=o(`<h3 id="返回结果接收方式" tabindex="-1"><a class="header-anchor" href="#返回结果接收方式" aria-hidden="true">#</a> 返回结果接收方式</h3><p><strong>setresulttransformer与addentity的区别</strong></p><blockquote><p>一个区别是前者支持查任意的列，后者必须用select * from users的形式或select {a.<em>},{b.</em>} from a,b where ....。</p><p>如果使用原生sql语句进行query查询时，hibernate是不会自动把结果包装成实体的。所以要手动调用addentity(class class)等一系列方法。</p><p>如session.createsqlquery(sql).addentity(class class);注意hibernate3.0.5不支持，单个参数的addentity方法</p><p>另外，hibernate3.2可以对原生sql 查询使用resulttransformer。这会返回不受hibernate管理的实体。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>session<span class="token punctuation">.</span><span class="token function">createsqlquery</span><span class="token punctuation">(</span><span class="token string">&quot;select name ,age,birthday from students&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">setresulttransformer</span><span class="token punctuation">(</span>transformers<span class="token punctuation">.</span><span class="token function">aliastobean</span><span class="token punctuation">(</span>students<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment">// 或</span>
<span class="token function">setresulttransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> aliastobeanresulttransformer <span class="token punctuation">(</span>students<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><blockquote><p>上面的查询将会返回students的列表,它将被实例化并且将name和birthday的值注射入对应的属性或者字段。 但必须注意，对每一个列都必须addscalar(&quot;列名&quot;)</p></blockquote></blockquote><p><strong>返回结果转换为Map</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createSQLQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setResultTransformer</span><span class="token punctuation">(</span><span class="token class-name">Transformers</span><span class="token punctuation">.</span><span class="token constant">ALIAS_TO_ENTITY_MAP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">createSQLQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setResultTransformer</span><span class="token punctuation">(</span><span class="token class-name">Transformers</span><span class="token punctuation">.</span><span class="token constant">ALIAS_TO_ENTITY_MAP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uniqueResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>当确定返回的实例只有一个或者null时 用uniqueResult()方法</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Double</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">createSQLQuery</span><span class="token punctuation">(</span>querySql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uniqueResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="hql查询" tabindex="-1"><a class="header-anchor" href="#hql查询" aria-hidden="true">#</a> HQL查询</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> hql <span class="token operator">=</span> <span class="token string">&quot;from Invest i where i.loan.id=? and i.status=?&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Invest</span><span class="token punctuation">&gt;</span></span> is <span class="token operator">=</span> ht<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> loanId<span class="token punctuation">,</span> <span class="token class-name">InvestStatus</span><span class="token punctuation">.</span><span class="token constant">REPAYING</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
<span class="token class-name">String</span> hql <span class="token operator">=</span> <span class="token string">&quot;from Invest i where i.loan.id=? and i.status=?&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Invest</span><span class="token punctuation">&gt;</span></span> is <span class="token operator">=</span> ht<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>hql<span class="token punctuation">,</span> loanId<span class="token punctuation">,</span> <span class="token class-name">InvestStatus</span><span class="token punctuation">.</span><span class="token constant">REPAYING</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用in，同createSQLQuery使用方式一样</span>
<span class="token class-name">String</span> hql <span class="token operator">=</span> <span class="token string">&quot;from Invest i where i.loan.id=? and i.status in(:status)&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Invest</span><span class="token punctuation">&gt;</span></span> is <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> loanId<span class="token punctuation">)</span>
					<span class="token punctuation">.</span><span class="token function">setParameterList</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">InvestStatus</span><span class="token punctuation">.</span><span class="token constant">REPAYING</span><span class="token punctuation">,</span> <span class="token class-name">InvestStatus</span><span class="token punctuation">.</span><span class="token constant">OVERDUE</span><span class="token punctuation">,</span>
							<span class="token class-name">InvestStatus</span><span class="token punctuation">.</span><span class="token constant">COMPLETE</span><span class="token punctuation">,</span> <span class="token class-name">InvestStatus</span><span class="token punctuation">.</span><span class="token constant">BID_SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="qbc查询" tabindex="-1"><a class="header-anchor" href="#qbc查询" aria-hidden="true">#</a> QBC查询</h3><blockquote><p>该方式只能用关联表的关联字段为查询条件，无法使用关联表的其他字段为查询条件</p></blockquote><blockquote><p>Criteria 和 DetachedCriteria 的主要区别在于创建的形式不一样, Criteria 是在线的，所以它是由hibernate Session 进行创建的； 而 DetachedCriteria 是离线的，创建时无需Session ，DetachedCriteria 提供了 2 个静态方法 forClass(Class) 或 forEntityName(Name)进行DetachedCriteria 实例的创建。</p></blockquote><blockquote><p>spring 的框架提供了getHibernateTemplate().findByCriteria(detachedCriteria) 方法可以很方便地根据DetachedCriteria 来返回查询结果。</p></blockquote><p><strong>hibernate5.2版本之前createCriteria()查询的方式</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Restrictions.in传值为数组或list集合</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> status <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">InvestConstants<span class="token punctuation">.</span>InvestStatus</span><span class="token punctuation">.</span><span class="token constant">REPAYING</span><span class="token punctuation">,</span><span class="token class-name">InvestConstants<span class="token punctuation">.</span>InvestStatus</span><span class="token punctuation">.</span><span class="token constant">OVERDUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DetachedCriteria</span> criteria <span class="token operator">=</span> <span class="token class-name">DetachedCriteria</span><span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span><span class="token class-name">InvestExtensionPlan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">createAlias</span><span class="token punctuation">(</span><span class="token string">&quot;invest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 当查询关联第三张表时，第二张表需要取别名</span>
criteria<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;i.loan.id&quot;</span><span class="token punctuation">,</span> loanExtensionPlan<span class="token punctuation">.</span><span class="token function">getLoan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可解决ORACLE in 大于1000问题</span>
criteria<span class="token punctuation">.</span><span class="token function">addOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;period&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 添加排序</span>

<span class="token comment">// 查询一范围内的的数据,需借助Criteria来查询</span>
<span class="token class-name">Criteria</span> cri <span class="token operator">=</span> criteria<span class="token punctuation">.</span><span class="token function">getExecutableCriteria</span><span class="token punctuation">(</span>ht<span class="token punctuation">.</span><span class="token function">getSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cri<span class="token punctuation">.</span><span class="token function">setFirstResult</span><span class="token punctuation">(</span>firstResult<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 从第几条开始</span>
cri<span class="token punctuation">.</span><span class="token function">setMaxResults</span><span class="token punctuation">(</span>maxResults<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 查询多少条</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InvestExtensionPlan</span><span class="token punctuation">&gt;</span></span> investExtensionPlans <span class="token operator">=</span> ht<span class="token punctuation">.</span><span class="token function">findByCriteria</span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 可解决ORACLE in 大于1000问题</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addCriteriaIn</span><span class="token punctuation">(</span><span class="token class-name">String</span> propertyName<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">Criteria</span> criteria<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Disjunction</span> or <span class="token operator">=</span> <span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">disjunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> subList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            or<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span> subList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    or<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    criteria<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>or<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>模糊查询和自定义查询</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>criteria<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;%&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;2018-11-13&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
criteria<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Restrictions</span><span class="token punctuation">.</span><span class="token function">sqlRestriction</span><span class="token punctuation">(</span><span class="token string">&quot;time like &#39;%2018-11-13%&#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>hibernate5.2及之后版本createCriteria()查询的方式</strong></p><blockquote><p>原有的session.createCriteria()方法已经过时，替代的方式是使用JPA Criteria。</p></blockquote><blockquote><p>session.createSQLCriteria()方法也过时了，当然可以用session.createNativeCriteria()方法来代替。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//注意导入的包是import javax.persistence.criteria.CriteriaQuery;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    session<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1.创建CriteriaBuilder,用于创建查询</span>
    <span class="token class-name">CriteriaBuilder</span> criteriaBuilder <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2.创建CriteriaQuery,用于设置查询语句的信息</span>
    <span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> criteriaQuery <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3.定义查询的From子句中能出现的类型,也可以用root.get()获取具体的某个属性</span>
    <span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteriaQuery<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4.设置WHERE字句的条件，此处条件为score&lt;= 98</span>
    criteriaQuery<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>criteriaBuilder<span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;score&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5.设置排序标准与排序方式</span>
    criteriaQuery<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>criteriaBuilder<span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;score&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//6.创建Query对象并获取结果集list</span>
    <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteriaQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// List&lt;Student&gt; list = session.createQuery(criteriaQuery).getResultList();</span>
    <span class="token comment">//7.遍历结果集</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    session<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    session<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>多表查询</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    session<span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1.创建CriteriaBuilder</span>
    <span class="token class-name">CriteriaBuilder</span> criteriaBuilder <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getCriteriaBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2.创建CriteriaQuery</span>
    <span class="token class-name">CriteriaQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Country</span><span class="token punctuation">&gt;</span></span> criteriaQuery <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token class-name">Country</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3.设置distinct去重</span>
    criteriaQuery<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4.获取root句柄</span>
    <span class="token class-name">Root</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Country</span><span class="token punctuation">&gt;</span></span> root <span class="token operator">=</span> criteriaQuery<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">Country</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5.设置fetch的连接对象以及连接类型，此处为迫切左外连接</span>
    root<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;ministers&quot;</span><span class="token punctuation">,</span> <span class="token class-name">JoinType</span><span class="token punctuation">.</span><span class="token constant">LEFT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//6.设置where查询条件</span>
    criteriaQuery<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>criteriaBuilder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;cid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//7.获取Query对象</span>
    <span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Country</span><span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span>criteriaQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//8.获取查询结构</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Country</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// List&lt;Student&gt; list = session.createQuery(criteriaQuery).getResultList();</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Country</span> country <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">;</span>
	country<span class="token punctuation">.</span><span class="token function">getMinisters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    session<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    session<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,25),yn={href:"http://www.voidcn.com/article/p-kixpjimv-qq.html",target:"_blank",rel:"noopener noreferrer"},jn=o(`<h3 id="关闭session" tabindex="-1"><a class="header-anchor" href="#关闭session" aria-hidden="true">#</a> 关闭session</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	session<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	session<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>hibernate中evict()和clear()的区别</li></ul><blockquote><p>session.evict(obj)：会把指定的缓冲对象从一级缓存中进行清除；</p></blockquote><blockquote><p>session.clear()：把一级缓存中的全部对象清除，但不包括操作中的对象。</p></blockquote><ul><li>hibernate执行的顺序如下：</li></ul><blockquote><p>(1)生成一个事务的对象，并标记当前的session处于事务状态（此时并未启动数据库级事务）。</p></blockquote><blockquote><p>(2)应用使用s.save()保存对象，这个时候Session将这个对象放入entityEntries，用来标记对象已经和当前的会话建立了关联， 由于应用对对对象做了保存的操作，Session还要在insertions中登记应用的这个插入行为(行为包括：对象引用、对象id、Session、持久化处理类)。</p></blockquote><blockquote><p>(3)s.evict()将对象从s会话中拆离，这时s会从entityEntries中将这个对象移除。</p></blockquote><blockquote><p>(4)事务提示，需要将所有缓存flush入数据库，Session启动一个事务，并按照insert ,update,...,delete的顺序提交所有之前登记的操作 （注意：所有insert执行完毕后才会执行update，这里的特殊处理也可能会将你的程序搞得一团遭，如需要控制操作的顺序，需要使用flush）， 现在对象不再entityEntries中，但在执行insert的行为时只需要访问insertions就足够了，所以此时不会有任何的异常， 异常出现在插入后通知Session该对象已经插入完毕这个步骤上，这个步骤中需要将entityEntries中对象的existsInDatabase标志置true， 由于对象并不存在于entityEntres中，此时Hibernate就认为insertions和entityEntries可能因为线程安全的问题产生了不同步 （也不知道Hibernate的开发者是否考虑到例子中的处理方式，如果没有的话，这也许算是一个bug吧）， 于是一个net.sf.hibernate.AssertionFailure就被抛出，程序终止。</p></blockquote><blockquote><p>一般我们会错误的认为s.sava会立即执行，而将对象过早的与session拆离，造成了session的insertion和entityEntries中内容的不同步。 所以我们在做此类操作时一定要清楚hibernate什么时候会将数据flush入数据库，在未flush之前不要将已进行操作的对象从session上拆离，解决办法是在sava之后，添加session.flush。</p></blockquote><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 验证缓存管理的方法evict
 * 执行完evict之后，将会将id为5的user对象从一级缓存中移除，再次访问的话将重新查询数据库
 * 该用例将发出2个select语句
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testEvict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token class-name">HibernateUtil</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">User</span> user1 <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	session<span class="token punctuation">.</span><span class="token function">evict</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">User</span> user2 <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * 验证缓存管理的方法clear
 * 执行clear方法之后，一级缓存中的对象全部被清除，再次查询，将从数据库中查询
 * 该用例将发出2个select语句
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token class-name">HibernateUtil</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">User</span> user1 <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=======================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">User</span> user2 <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	session<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="只读错误" tabindex="-1"><a class="header-anchor" href="#只读错误" aria-hidden="true">#</a> 只读错误</h3><blockquote><p>Write operations are not allowed in read-only mode (FlushMode.MANUAL): Turn your Session into FlushMode.COMMIT/AUTO or remove &#39;readOnly&#39; marker from transaction definition.</p></blockquote><blockquote><p>写操作在只读模式下不被允许(FlushMode.MANUAL): 把你的Session改成FlushMode.COMMIT/AUTO或者清除事务定义中的readOnly标记。</p></blockquote><h3 id="编程式修改flushmode" tabindex="-1"><a class="header-anchor" href="#编程式修改flushmode" aria-hidden="true">#</a> 编程式修改FlushMode</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>ht<span class="token punctuation">.</span><span class="token function">setFlushMode</span><span class="token punctuation">(</span><span class="token class-name">HibernateTemplate</span><span class="token punctuation">.</span><span class="token constant">FLUSH_AUTO</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ht<span class="token punctuation">.</span><span class="token function">getSessionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCurrentSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFlushMode</span><span class="token punctuation">(</span><span class="token class-name">FlushMode</span><span class="token punctuation">.</span><span class="token constant">AUTO</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置过滤器" tabindex="-1"><a class="header-anchor" href="#配置过滤器" aria-hidden="true">#</a> 配置过滤器</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>OpenSessionInViewFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>org.springframework.orm.hibernate3.support.OpenSessionInViewFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- singleSession默认为true,若设为false则等于没用OpenSessionInView 。所以默认可以不写 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>singleSession<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 设置flushMode为AUTO(在确保查询从不会返回脏数据的情况下，在查询前刷新Session。)/COMMIT(Session在提交事务时刷新。) --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>flushMode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>AUTO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>OpenSessionInViewFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用execute方法回调方式实现" tabindex="-1"><a class="header-anchor" href="#使用execute方法回调方式实现" aria-hidden="true">#</a> 使用execute方法回调方式实现</h3><ul><li>Dao层HibernateTemplate操作数据时，使用execute方法回调方式实现：</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 原方式</span>
<span class="token function">getHibernateTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 更改后方式</span>
<span class="token function">getHibernateTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HibernateCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">doInHibernate</span><span class="token punctuation">(</span><span class="token class-name">Session</span> session<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">HibernateException</span> <span class="token punctuation">{</span>
		session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22);function Sn(wn,xn){const e=c("router-link"),t=c("ExternalLinkIcon");return i(),u("div",null,[k,n("nav",d,[n("ul",null,[n("li",null,[a(e,{to:"#flag"},{default:p(()=>[s("Flag")]),_:1})]),n("li",null,[a(e,{to:"#jdbc驱动"},{default:p(()=>[s("JDBC驱动")]),_:1})]),n("li",null,[a(e,{to:"#mybatis"},{default:p(()=>[s("Mybatis")]),_:1})]),n("li",null,[a(e,{to:"#hibernate"},{default:p(()=>[s("Hibernate")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#返回结果接收方式"},{default:p(()=>[s("返回结果接收方式")]),_:1})]),n("li",null,[a(e,{to:"#hql查询"},{default:p(()=>[s("HQL查询")]),_:1})]),n("li",null,[a(e,{to:"#qbc查询"},{default:p(()=>[s("QBC查询")]),_:1})]),n("li",null,[a(e,{to:"#关闭session"},{default:p(()=>[s("关闭session")]),_:1})]),n("li",null,[a(e,{to:"#只读错误"},{default:p(()=>[s("只读错误")]),_:1})]),n("li",null,[a(e,{to:"#编程式修改flushmode"},{default:p(()=>[s("编程式修改FlushMode")]),_:1})]),n("li",null,[a(e,{to:"#配置过滤器"},{default:p(()=>[s("配置过滤器")]),_:1})]),n("li",null,[a(e,{to:"#使用execute方法回调方式实现"},{default:p(()=>[s("使用execute方法回调方式实现")]),_:1})])])])])]),m,v,n("ul",null,[n("li",null,[n("a",b,[s("https://sourceforge.net/projects/jpox"),a(t)])]),n("li",null,[n("a",g,[s("Java，JDBC和MySQL对应数据类型"),a(t)])]),n("li",null,[n("a",h,[s("http://www.squirrelsql.org"),a(t)])]),n("li",null,[n("a",f,[s("http://java-source.net/open-source/sql-clients"),a(t)])]),n("li",null,[s("链式SQL框架 "),n("a",_,[s("https://github.com/jOOQ"),a(t)])]),n("li",null,[n("a",q,[s("https://github.com/querydsl/querydsl"),a(t)])]),n("li",null,[n("a",y,[s("https://github.com/BatooOrg/BatooJPA"),a(t)])]),n("li",null,[n("a",j,[s("https://github.com/aaberg/sql2o"),a(t)])]),n("li",null,[n("a",S,[s("https://github.com/jdbi/jdbi"),a(t)])]),n("li",null,[s("toplink "),n("a",w,[s("https://github.com/eclipse-ee4j/eclipselink"),a(t)])]),n("li",null,[n("a",x,[s("https://github.com/datanucleus"),a(t)])]),n("li",null,[n("a",C,[s("https://github.com/apache/openjpa"),a(t)])]),n("li",null,[n("a",L,[s("https://github.com/spring-projects/spring-data-jdbc"),a(t)])]),n("li",null,[n("a",T,[s("https://github.com/apache/commons-dbutils"),a(t)])]),n("li",null,[s("只读查询 "),n("a",M,[s("https://github.com/ejlchina/bean-searcher"),a(t)])]),n("li",null,[n("a",A,[s("https://github.com/speedment"),a(t)])]),n("li",null,[s("SQL解析和验证器 "),n("a",E,[s("https://github.com/apache/calcite"),a(t)])])]),n("ul",null,[n("li",null,[n("a",R,[s("https://github.com/itfsw/mybatis-generator-plugin"),a(t)])]),n("li",null,[s("CRUD生成器 "),n("a",I,[s("https://github.com/SanjinKurelic/MVCGenerator"),a(t)])]),n("li",null,[n("a",Q,[s("https://github.com/jeddict/jeddict"),a(t)])]),n("li",null,[n("a",O,[s("https://codverter.com/src/sqltoclass"),a(t)])]),n("li",null,[n("a",B,[s("https://gitee.com/l0km/sql2java"),a(t)]),n("ul",null,[n("li",null,[n("a",D,[s("https://sourceforge.net/projects/sql2java"),a(t)])]),n("li",null,[n("a",U,[s("https://github.com/xgp/sql2java"),a(t)])])])]),n("li",null,[n("a",F,[s("https://github.com/blinkfox/zealot"),a(t)])]),n("li",null,[n("a",N,[s("https://github.com/vipbooks/TableGo"),a(t)])]),n("li",null,[n("a",H,[s("https://github.com/jahlborn/sqlbuilder"),a(t)])]),n("li",null,[s("表结构文档生成 "),n("a",P,[s("https://github.com/pingfangushi/screw"),a(t)])]),n("li",null,[s("数据库中间件 "),n("a",z,[s("https://github.com/apache/shardingsphere"),a(t)]),n("ul",null,[n("li",null,[n("a",J,[s("https://github.com/apache/shardingsphere-elasticjob"),a(t)])])])]),n("li",null,[s("连接池 "),n("a",V,[s("https://github.com/brettwooldridge/HikariCP"),a(t)])]),n("li",null,[n("a",G,[s("https://github.com/alibaba/druid"),a(t)]),n("ul",null,[n("li",null,[n("a",Y,[s("Java工具篇之Druid SQL语法解析树"),a(t)])])])])]),W,n("ul",null,[n("li",null,[n("a",K,[s("https://github.com/codingapi/tx-lcn"),a(t)])]),n("li",null,[n("a",Z,[s("https://github.com/seata/seata"),a(t)])]),n("li",null,[n("a",X,[s("https://github.com/changmingxie/tcc-transaction"),a(t)])]),n("li",null,[n("a",$,[s("https://github.com/QNJR-GROUP/EasyTransaction"),a(t)])]),n("li",null,[n("a",nn,[s("https://github.com/liuyangming/ByteTCC"),a(t)])]),n("li",null,[n("a",sn,[s("https://github.com/wchswchs/Hulk"),a(t)])]),n("li",null,[n("a",an,[s("https://github.com/atomikos/transactions-essentials"),a(t)])])]),tn,n("ul",null,[n("li",null,[s("[(https://mysql-net.github.io/MySqlConnector/connection-options]((https://mysql-net.github.io/MySqlConnector/connection-options) "),n("ul",null,[n("li",null,[n("a",en,[s("https://mysqlconnector.net/connection-options"),a(t)])])])])]),pn,n("ul",null,[n("li",null,[n("a",on,[s("https://github.com/mybatis"),a(t)])]),n("li",null,[n("a",cn,[s("https://mybatis.org/mybatis-3/zh/dynamic-sql.html"),a(t)])]),n("li",null,[n("a",ln,[s("https://github.com/pagehelper/Mybatis-PageHelper"),a(t)])]),n("li",null,[n("a",un,[s("https://github.com/baomidou/mybatis-plus"),a(t)])]),n("li",null,[n("a",rn,[s("https://github.com/davidfantasy/mybatis-plus-generator-ui"),a(t)])])]),n("ul",null,[n("li",null,[n("a",kn,[s("https://github.com/alexdyysp/MybatisHandBook"),a(t)])])]),n("ul",null,[n("li",null,[n("a",dn,[s("干掉mapper.xml！MyBatis新特性动态SQL"),a(t)])]),n("li",null,[n("a",mn,[s("Mybatis 源码分析 (一) Mapper扫描及代理"),a(t)])]),n("li",null,[n("a",vn,[s("一条sql查出树形结构数据"),a(t)])]),n("li",null,[n("a",bn,[s("Sql中对于树形结构的处理"),a(t)])])]),gn,n("ul",null,[n("li",null,[n("a",hn,[s("https://github.com/hibernate"),a(t)])]),n("li",null,[n("a",fn,[s("https://github.com/vladmihalcea/hypersistence-optimizer"),a(t)])]),n("li",null,[n("a",_n,[s("https://github.com/jeecgboot/MiniDao"),a(t)])])]),qn,n("ul",null,[n("li",null,[n("a",yn,[s("调用hibernate存储过程"),a(t)])])]),jn])}const Tn=l(r,[["render",Sn],["__file","ORM.html.vue"]]);export{Tn as default};
