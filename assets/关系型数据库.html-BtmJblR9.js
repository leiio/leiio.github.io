import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as l,o as r,c as i,b as n,a,w as p,d as s,f as t}from"./app-BGG14fOW.js";const u={},d=n("h1",{id:"关系型数据库",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#关系型数据库","aria-hidden":"true"},"#"),s(" 关系型数据库")],-1),k={class:"table-of-contents"},m=n("h2",{id:"flag",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#flag","aria-hidden":"true"},"#"),s(" Flag")],-1),b=n("blockquote",null,[n("p",null,"关系型数据库（Relational database），是指采用了关系模型来组织数据的数据库，其以行和列的形式存储数据，以便于用户理解 ，关系型数据库这一系列的行和列被称为表，一组表组成了数据库")],-1),h={href:"https://github.com/opengauss-mirror",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/MariaDB",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/percona/percona-server",target:"_blank",rel:"noopener noreferrer"},_={href:"https://github.com/sysown/proxysql",target:"_blank",rel:"noopener noreferrer"},w={href:"https://github.com/cstack/db_tutorial",target:"_blank",rel:"noopener noreferrer"},y={href:"http://www.h2database.com",target:"_blank",rel:"noopener noreferrer"},E={href:"https://sourceforge.net/projects/hsqldb",target:"_blank",rel:"noopener noreferrer"},f={href:"http://hsqldb.org",target:"_blank",rel:"noopener noreferrer"},T={href:"https://github.com/FirebirdSQL/firebird",target:"_blank",rel:"noopener noreferrer"},q={href:"https://github.com/duckdb/duckdb",target:"_blank",rel:"noopener noreferrer"},A={href:"https://github.com/babelfish-for-postgresql",target:"_blank",rel:"noopener noreferrer"},S={href:"https://github.com/timescale/timescaledb",target:"_blank",rel:"noopener noreferrer"},N={href:"https://github.com/greenplum-db",target:"_blank",rel:"noopener noreferrer"},L=n("p",null,[n("strong",null,"递归")],-1),M=n("blockquote",null,[n("p",null,"Common Table Expression(公共表表达式)：在CTE中可以包括对自身的引用，因此这种表达式也被称为递归CTE")],-1),O={href:"https://www.cnblogs.com/sheng-jie/p/6347835.html",target:"_blank",rel:"noopener noreferrer"},R={href:"https://www.cnblogs.com/FatalFlower/p/16464039.html",target:"_blank",rel:"noopener noreferrer"},C=t(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- ORACLE</span>
查询语句 <span class="token keyword">start</span> <span class="token keyword">with</span> 起始条件 <span class="token keyword">connect</span> <span class="token keyword">by</span> prior 递归条件
<span class="token comment">-- 其他数据库</span>
<span class="token keyword">with</span> recursive cte <span class="token keyword">as</span><span class="token punctuation">(</span>
 <span class="token keyword">select</span> user_id<span class="token punctuation">,</span>manager_id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>name <span class="token keyword">as</span> manager_name <span class="token keyword">from</span> employee <span class="token keyword">where</span> manager_id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>
 <span class="token keyword">union</span> <span class="token keyword">all</span>
 <span class="token keyword">select</span> c<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span>c<span class="token punctuation">.</span>manager_id<span class="token punctuation">,</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span>p<span class="token punctuation">.</span>name <span class="token keyword">as</span> manager_name <span class="token keyword">from</span> cte p<span class="token punctuation">,</span> employee c <span class="token keyword">on</span> p<span class="token punctuation">.</span>user_id<span class="token operator">=</span>c<span class="token punctuation">.</span>manager_id
<span class="token punctuation">)</span>
<span class="token keyword">select</span> user_id<span class="token punctuation">,</span>manager_id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>manager_name <span class="token keyword">from</span> cte
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="事务" tabindex="-1"><a class="header-anchor" href="#事务" aria-hidden="true">#</a> 事务</h2><ul><li>脏数据：未提交的数据</li><li>不可重复读（Non-Repeatable Reads）：一个事务先后读取同一条记录，而事务在两次读取之间该数据被其它事务所修改，则两次读取的数据不同</li><li>幻读（Phantom Reads）：一个事务按相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据</li></ul>`,3),x={href:"https://www.cnblogs.com/jerryliuxin/p/15441437.html",target:"_blank",rel:"noopener noreferrer"},I={href:"https://www.cnblogs.com/yubaolee/p/10398633.html",target:"_blank",rel:"noopener noreferrer"},D={href:"https://blog.csdn.net/weixin_45730866/article/details/123654710",target:"_blank",rel:"noopener noreferrer"},B={href:"https://www.jianshu.com/p/fc8a654f2205",target:"_blank",rel:"noopener noreferrer"},P=t('<p>1、A (Atomicity) 原子性</p><blockquote><p>一个事务要么全部提交成功，要么全部失败回滚，不能只执行其中的一部分操作，只要有一个操作失败，整个事务就失败，需要回滚。 例如：从A账户转10元至B账户，分为两个步骤：1.从A账户取10元；2.存入10元至B账户。这两步要么一起完成，要么一起不完成，当只完成第一步，第二步失败的情况下 ，钱就会回滚到A账户中去，否则的话，钱就会莫名其妙少了10元。</p></blockquote><p>2、C (Consistency) 一致性</p><blockquote><p>数据库要一直处于一致的状态，事务的运行不会改变数据库原本的一致性约束。 例如：现有完整性约束a+b=10，如果一个事务改变了a，那么必须得改变b，使得事务结束后依然满足a+b=10，否则事务失败。</p></blockquote><p>3、I (Isolation) 独立性/隔离性</p><blockquote><p>并发的事务之间不会互相影响，如果一个事务要访问的数据正在被另外一个事务修改，只要另外一个事务未提交，它所访问的数据就不受未提交事务的影响。 例如：现在从A账户转10元至B账户，在这个交易还未完成的情况下，如果此时B查询自己的账户，是看不到新增加的10的。</p></blockquote><p>4、D (Durability) 持久性</p><blockquote><p>一旦事务提交后，它所做的修改将会永久的保存在数据库上，即使出现宕机也不会丢失</p></blockquote><p><strong>运行模式</strong></p><ol><li>自动提交事务：默认事务管理模式。如果一个语句成功地完成，则提交该语句；如果遇到错误，则回滚该语句。</li><li>显式事务：以BEGIN TRANSACTION显式开始，以COMMIT或ROLLBACK显式结束。</li><li>隐性事务：当连接以此模式进行操作时，sql将在提交或回滚当前事务后自动启动新事务。无须描述事务的开始，只需提交或回滚每个事务。它生成连续的事务链。</li></ol><h2 id="数据库设计" tabindex="-1"><a class="header-anchor" href="#数据库设计" aria-hidden="true">#</a> 数据库设计</h2><p><strong>范式：Normal Format</strong></p><blockquote><p>符合某一种级别的关系模式的集合，表示一个关系内部各属性之间的联系的合理化程度。一个数据库表之间的所有字段之间的联系的合理性。</p></blockquote><ul><li>范式是离散数学里的概念</li><li>范式目标是在满足组织和存储的前提下使数据结构冗余最小化</li><li>范式级别越高，表的级别就越标准</li></ul><ul><li>第一范式：1NF，确保表中每一列数据的原子性，不可再分！</li><li>第二范式：2NF，在满足第一范式的基础上，确保列数据要跟主键关联，不能出现部分依赖。</li><li>第三范式：3NF，再满足第二范式的基础上，保证每一列数据都要跟主键直接关联，不能出现传递依赖。</li><li>BCNF范式,4NF,5NF</li><li>反范式：用空间换时间，通过适当的数据冗余提高查询效率，但冗余数据会牺牲数据一致性</li></ul>',15),F={href:"https://zhuanlan.zhihu.com/p/353493253",target:"_blank",rel:"noopener noreferrer"},j={href:"https://www.cnblogs.com/jingzh/p/15270698.html",target:"_blank",rel:"noopener noreferrer"},U={href:"https://bbs.huaweicloud.com/blogs/286564",target:"_blank",rel:"noopener noreferrer"},H={href:"https://www.jianshu.com/p/8bfe4ed00f88",target:"_blank",rel:"noopener noreferrer"},Q={href:"https://blog.csdn.net/chezong/article/details/123322973",target:"_blank",rel:"noopener noreferrer"},Y=n("h2",{id:"oracle",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#oracle","aria-hidden":"true"},"#"),s(" ORACLE")],-1),W={href:"https://blog.csdn.net/qq_34745941/article/details/106897099",target:"_blank",rel:"noopener noreferrer"},z=n("em",null,"+ materialize",-1),J=t(`<blockquote><p>空字符串&#39;&#39;同等NULL，字符串与数字类型会自动转换</p></blockquote><p><strong>系统表</strong></p><ul><li><code>USER_TABLES</code> 当前用户拥有的表：<code>TABLE_NAME</code>,<code>TABLESPACE_NAME</code>,<code>LAST_ANALYZED</code></li><li><code>DBA_TABLES</code> 包括系统表：多了<code>OWER</code>列</li><li><code>ALL_TABLES</code> 所有用户的表：多了<code>OWER</code>列</li><li><code>ALL_OBJECTS</code> 当前用户有访问权限的所有对象：<code>OWER</code>,<code>OBJECT_NAME</code>,<code>SUBOBJECT_NAME</code>,<code>OBJECT_ID</code>,<code>CREATED</code>,<code>LAST_DDL_TIME</code>,<code>TIMESTAMP</code>,<code>STATUS</code></li><li><code>USER_TAB_COLUMNS</code> 当前用户拥有的表字段</li><li><code>ALL_TAB_COLUMNS</code></li><li><code>DBA_TAB_COLUMNS</code></li><li><code>USER_TAB_COMMENTS</code> 当前用户拥有的表注释 ：<code>TABLE_NAME</code>,<code>TABLE_TYPE</code>,<code>COMMENTS</code></li><li><code>DBA_TAB_COMMENTS</code> ：多了<code>OWER</code>列</li><li><code>ALL_TAB_COMMENTS</code> ：多了<code>OWER</code>列</li><li><code>USER_COL_COMMENTS</code> 当前用户拥有的表字段注释 ： <code>TABLE_NAME</code>,<code>COLUMN_NAME</code>,<code>COMMENTS</code></li><li><code>DBA_COL_COMMENTS</code> ：多了<code>OWER</code>列</li><li><code>ALL_COL_COMMENTS</code> ：多了<code>OWER</code>列</li></ul><blockquote><p><code>SELECT * FROM USER_TAB_COMMENTS WHERE COMMENTS LIKE &#39;%摘要%&#39;</code></p></blockquote><p><strong>分组获取最新一条数据（查询各组最新的一条记录）</strong></p><ul><li>over partition by 分析函数（开窗函数）</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> 分组字段名 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 排序字段名 <span class="token keyword">DESC</span><span class="token punctuation">)</span> rn<span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> test1 t
    <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> rn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> eb_vipcode<span class="token punctuation">,</span>eb_time<span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>eb_time<span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> eb_vipcode<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&quot;atime&quot;</span> <span class="token keyword">from</span> eb_daskexpdateinfo
    <span class="token punctuation">)</span> x <span class="token keyword">where</span> eb_time <span class="token operator">=</span> <span class="token string">&quot;atime&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> ID_<span class="token punctuation">,</span>COMPANY_NAME<span class="token punctuation">,</span>USAGE_RATE<span class="token punctuation">,</span>CREATE_TIME
    <span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>CREATE_TIME<span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">partition</span> <span class="token keyword">by</span> COMPANY_NAME<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&quot;atime&quot;</span> <span class="token keyword">from</span> SPEC_RATE_ORIGIN
    <span class="token punctuation">)</span> x <span class="token keyword">where</span> CREATE_TIME <span class="token operator">=</span> <span class="token string">&quot;atime&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>group by</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> eb_vipcode<span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>eb_time<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;atime&quot;</span> <span class="token keyword">FROM</span> eb_daskexpdateinfo <span class="token keyword">group</span> <span class="token keyword">by</span> eb_vipcode
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>inner join</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> SPEC_RATE_ORIGIN A <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> COMPANY_NAME<span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>CREATE_TIME<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;atime&quot;</span> <span class="token keyword">FROM</span> SPEC_RATE_ORIGIN <span class="token keyword">group</span> <span class="token keyword">by</span> COMPANY_NAME
    <span class="token punctuation">)</span> B <span class="token keyword">ON</span> A<span class="token punctuation">.</span>COMPANY_NAME <span class="token operator">=</span> B<span class="token punctuation">.</span>COMPANY_NAME <span class="token operator">AND</span> A<span class="token punctuation">.</span>CREATE_TIME <span class="token operator">=</span> B<span class="token punctuation">.</span><span class="token string">&quot;atime&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>一次执行多条SQL</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">ALL</span>
 <span class="token keyword">INTO</span> a表<span class="token punctuation">(</span>字段<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>各个值<span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token keyword">INTO</span> a表<span class="token punctuation">(</span>字段<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>其它值<span class="token number">2</span><span class="token punctuation">)</span>
 <span class="token keyword">INTO</span> a表<span class="token punctuation">(</span>字段<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>其它值<span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用<code>begin…end;</code></li></ul>`,14),V={href:"https://www.cnblogs.com/teamleader/archive/2007/05/31/765943.html",target:"_blank",rel:"noopener noreferrer"},G=t(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">begin</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> table_name <span class="token punctuation">(</span>列名<span class="token punctuation">,</span>列名<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>express<span class="token punctuation">,</span>express<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> table_name <span class="token punctuation">(</span>列名<span class="token punctuation">,</span>列名<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>express<span class="token punctuation">,</span>express<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> table_name <span class="token punctuation">(</span>列名<span class="token punctuation">,</span>列名<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>express<span class="token punctuation">,</span>express<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> table_name <span class="token punctuation">(</span>列名<span class="token punctuation">,</span>列名<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>express<span class="token punctuation">,</span>express<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>插入或更新 upsert</strong></p>`,2),K={href:"https://www.jianshu.com/p/602ba0b8395b",target:"_blank",rel:"noopener noreferrer"},X={href:"https://blog.csdn.net/weixin_40374341/article/details/109239544",target:"_blank",rel:"noopener noreferrer"},$=t(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">MERGE</span> <span class="token keyword">INTO</span> table_name alias1   
<span class="token keyword">USING</span> <span class="token punctuation">(</span><span class="token keyword">table</span><span class="token operator">|</span><span class="token keyword">view</span><span class="token operator">|</span>sub_query<span class="token punctuation">)</span> alias2  
<span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token keyword">join</span> condition<span class="token punctuation">)</span>   
<span class="token keyword">WHEN</span> <span class="token keyword">MATCHED</span> <span class="token keyword">THEN</span>   
    <span class="token keyword">UPDATE</span> table_name <span class="token keyword">SET</span> col1 <span class="token operator">=</span> col_val1
<span class="token keyword">WHEN</span> <span class="token operator">NOT</span> <span class="token keyword">MATCHED</span> <span class="token keyword">THEN</span>   
    <span class="token keyword">INSERT</span> <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>column_values<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>修改字段</strong></p>`,2),Z={href:"https://www.cnblogs.com/beloved-bq/p/12561512.html",target:"_blank",rel:"noopener noreferrer"},nn=t(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 创建会话级临时表来存储原数据，并删除表数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> TEST_BAK <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> TEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查看临时表数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> TEST_BAK<span class="token punctuation">;</span>

<span class="token comment">-- 清空数据 delete是dml操作；truncate是ddl操作，ddl隐式提交不能回滚，会回收表空间</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> TEST<span class="token punctuation">;</span>
<span class="token comment">-- 将目标字段数据清空</span>
<span class="token comment">--UPDATE TEST SET MEASURED = NULL;</span>

<span class="token comment">-- 修改表字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> TEST <span class="token keyword">MODIFY</span> MEASURED NUMBER<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 还原表结构</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TEST <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> TEST_BAK<span class="token punctuation">;</span>

<span class="token comment">-- 删除临时表</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> TEST_BAK<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>死锁</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 查询死锁会话</span>
<span class="token keyword">SELECT</span> l<span class="token punctuation">.</span>session_id sid<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token keyword">serial</span><span class="token comment">#, l.locked_mode, l.oracle_username, l.os_user_name</span>
<span class="token punctuation">,</span> s<span class="token punctuation">.</span>machine<span class="token punctuation">,</span> s<span class="token punctuation">.</span>terminal<span class="token punctuation">,</span> o<span class="token punctuation">.</span>object_name<span class="token punctuation">,</span> s<span class="token punctuation">.</span>logon_time<span class="token punctuation">,</span> p<span class="token punctuation">.</span>SPID
 <span class="token keyword">FROM</span> v$locked_object l<span class="token punctuation">,</span> all_objects o<span class="token punctuation">,</span> v$<span class="token keyword">session</span> s<span class="token punctuation">,</span>v$process p
 <span class="token keyword">WHERE</span> l<span class="token punctuation">.</span>object_id <span class="token operator">=</span> o<span class="token punctuation">.</span>object_id <span class="token operator">AND</span> l<span class="token punctuation">.</span>session_id <span class="token operator">=</span> s<span class="token punctuation">.</span>sid <span class="token operator">AND</span> s<span class="token punctuation">.</span>paddr <span class="token operator">=</span> p<span class="token punctuation">.</span>addr
 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sid<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token keyword">serial</span><span class="token comment">#;</span>

<span class="token comment">-- 结束</span>
<span class="token keyword">alter</span> system <span class="token keyword">kill</span> <span class="token keyword">session</span> <span class="token string">&#39;sid,serial#&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>orakill SID spid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>查看所有表结构</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>Table_Name <span class="token operator">||</span> chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">||</span> t3<span class="token punctuation">.</span>comments       <span class="token keyword">AS</span> <span class="token string">&quot;表名称及说明&quot;</span><span class="token punctuation">,</span>
       <span class="token comment">--t3.comments                                 AS &quot;表说明&quot;,</span>
       t1<span class="token punctuation">.</span>COLUMN_ID                                  <span class="token keyword">AS</span> <span class="token string">&quot;序号&quot;</span><span class="token punctuation">,</span>
       t1<span class="token punctuation">.</span>Column_Name                                <span class="token keyword">AS</span> <span class="token string">&quot;字段名称&quot;</span><span class="token punctuation">,</span>
       t1<span class="token punctuation">.</span>DATA_TYPE <span class="token operator">||</span> <span class="token string">&#39;(&#39;</span> <span class="token operator">||</span> t1<span class="token punctuation">.</span>DATA_LENGTH <span class="token operator">||</span> <span class="token string">&#39;)&#39;</span>  <span class="token keyword">AS</span> <span class="token string">&quot;数据类型&quot;</span><span class="token punctuation">,</span>
       t1<span class="token punctuation">.</span>NullAble                                   <span class="token keyword">AS</span> <span class="token string">&quot;是否为空&quot;</span><span class="token punctuation">,</span>
       t2<span class="token punctuation">.</span>Comments                                   <span class="token keyword">AS</span> <span class="token string">&quot;字段说明&quot;</span><span class="token punctuation">,</span>
       t1<span class="token punctuation">.</span>Data_Default                               <span class="token keyword">AS</span> <span class="token string">&quot;默认值&quot;</span>
       <span class="token comment">--t4.created                                  AS &quot;建表时间&quot;</span>
  <span class="token keyword">FROM</span> cols t1
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> user_col_comments t2 
         <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>Table_name <span class="token operator">=</span> t2<span class="token punctuation">.</span>Table_name
        <span class="token operator">AND</span> t1<span class="token punctuation">.</span>Column_Name <span class="token operator">=</span> t2<span class="token punctuation">.</span>Column_Name
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> user_tab_comments t3 
         <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>Table_name <span class="token operator">=</span> t3<span class="token punctuation">.</span>Table_name
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> user_objects t4 
         <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>table_name <span class="token operator">=</span> t4<span class="token punctuation">.</span>OBJECT_NAME
  <span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> t4<span class="token punctuation">.</span>Object_Name
          <span class="token keyword">FROM</span> User_objects t4
         <span class="token keyword">WHERE</span> t4<span class="token punctuation">.</span>Object_Type <span class="token operator">=</span> <span class="token string">&#39;TABLE&#39;</span>
           <span class="token operator">AND</span> t4<span class="token punctuation">.</span><span class="token keyword">Temporary</span> <span class="token operator">=</span> <span class="token string">&#39;Y&#39;</span>
           <span class="token operator">AND</span> t4<span class="token punctuation">.</span>Object_Name <span class="token operator">=</span> t1<span class="token punctuation">.</span>Table_Name<span class="token punctuation">)</span>
  <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>Table_Name<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>Column_ID<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>日期时间</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 得到当天凌晨0点0分0秒的日期</span>
<span class="token keyword">select</span> trunc<span class="token punctuation">(</span>sysdate<span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment">-- 得到这天的最后一秒</span>
<span class="token keyword">select</span> trunc<span class="token punctuation">(</span>sysdate<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.99999</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql" aria-hidden="true">#</a> PostgreSQL</h2>`,9),sn={href:"https://github.com/topics/postgrest",target:"_blank",rel:"noopener noreferrer"},an={href:"https://github.com/topics/postgresql",target:"_blank",rel:"noopener noreferrer"},en={href:"https://github.com/dhamaniasad/awesome-postgres",target:"_blank",rel:"noopener noreferrer"},tn={href:"https://github.com/citusdata",target:"_blank",rel:"noopener noreferrer"},on={href:"https://github.com/postgres/postgres",target:"_blank",rel:"noopener noreferrer"},pn={href:"http://postgres.cn/docs/13/catalogs.html",target:"_blank",rel:"noopener noreferrer"},ln={href:"https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING",target:"_blank",rel:"noopener noreferrer"},cn={href:"https://jdbc.postgresql.org",target:"_blank",rel:"noopener noreferrer"},rn={href:"https://github.com/postgrespro",target:"_blank",rel:"noopener noreferrer"},un={href:"https://github.com/pgpartman",target:"_blank",rel:"noopener noreferrer"},dn={href:"https://github.com/PostgREST/postgrest",target:"_blank",rel:"noopener noreferrer"},kn={href:"https://github.com/CrunchyData",target:"_blank",rel:"noopener noreferrer"},mn={href:"https://github.com/sosedoff/pgweb",target:"_blank",rel:"noopener noreferrer"},bn={href:"https://github.com/prest/prest",target:"_blank",rel:"noopener noreferrer"},hn={href:"https://github.com/alibaba/PolarDB-for-PostgreSQL",target:"_blank",rel:"noopener noreferrer"},vn={href:"https://github.com/tcdi/pgx",target:"_blank",rel:"noopener noreferrer"},gn={href:"https://github.com/zombodb/zombodb",target:"_blank",rel:"noopener noreferrer"},_n={href:"https://github.com/dongxuyang1985/postgresql_dev_guide",target:"_blank",rel:"noopener noreferrer"},wn={href:"https://blog.csdn.net/jsbylibo/article/details/108448400",target:"_blank",rel:"noopener noreferrer"},yn={href:"https://blog.csdn.net/neweastsun/article/details/112147693",target:"_blank",rel:"noopener noreferrer"},En={href:"http://postgres.cn/docs/14/queries-with.html",target:"_blank",rel:"noopener noreferrer"},fn={href:"https://juejin.cn/post/6844904061414670350",target:"_blank",rel:"noopener noreferrer"},Tn={href:"https://blog.csdn.net/sunshuo1231/article/details/79634998",target:"_blank",rel:"noopener noreferrer"},qn={href:"https://blog.csdn.net/u011447403/article/details/122877396",target:"_blank",rel:"noopener noreferrer"},An={href:"https://zhuanlan.zhihu.com/p/432124325",target:"_blank",rel:"noopener noreferrer"},Sn={href:"https://blog.csdn.net/Mr_Door/article/details/102527225",target:"_blank",rel:"noopener noreferrer"},Nn={href:"https://blog.csdn.net/neweastsun/article/details/121574175",target:"_blank",rel:"noopener noreferrer"},Ln={href:"https://blog.csdn.net/weixin_42583514/article/details/123063420",target:"_blank",rel:"noopener noreferrer"},Mn={href:"https://blog.csdn.net/dazuiba008/article/details/116709091",target:"_blank",rel:"noopener noreferrer"},On=t(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 插入或更新 upsert</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name<span class="token punctuation">(</span>column_list<span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span><span class="token punctuation">(</span>value_list<span class="token punctuation">)</span>
<span class="token keyword">ON</span> CONFLICT target <span class="token keyword">action</span><span class="token punctuation">;</span>

<span class="token comment">-- https://zhuanlan.zhihu.com/p/342722338</span>
<span class="token comment">-- https://dba.stackexchange.com/questions/91247/optimizing-a-postgres-query-with-a-large-in/91539</span>
<span class="token comment">-- 临时表</span>
<span class="token keyword">with</span> tmp_table <span class="token keyword">as</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> unnest<span class="token punctuation">(</span><span class="token string">&#39;{
        10000, 11000, 12000, 13000, 14000, 15000, 16000, 17000, 18000, 19000, 20000, 21000, 22000
    }&#39;</span>::<span class="token keyword">bigint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token string">&quot;aid&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tmp_table

<span class="token comment">-- https://zhuanlan.zhihu.com/p/38381497</span>
<span class="token comment">-- WITH ORDINALITY返回记录的每一行行号</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> unnest<span class="token punctuation">(</span>ARRAY<span class="token punctuation">[</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;d&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;e&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;f&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">WITH</span> ORDINALITY<span class="token punctuation">;</span>

<span class="token comment">-- 常量子查询</span>
字段 <span class="token operator">in</span> <span class="token punctuation">(</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">11000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">13000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">14000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">15000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">16000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">17000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">18000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">19000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- JSON</span>
<span class="token comment">-- https://www.postgresql.org/docs/current/functions-json.html</span>
<span class="token comment">-- https://www.crunchydata.com/developers/playground/basics-of-jsonb</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> jsonb_to_recordset<span class="token punctuation">(</span><span class="token string">&#39;[{&quot;name&quot;: &quot;batman&quot;}, {&quot;name&quot;: &quot;superman&quot;}]&#39;</span>::jsonb<span class="token punctuation">)</span> <span class="token keyword">AS</span> x<span class="token punctuation">(</span>name <span class="token keyword">TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> json_array_elements_text<span class="token punctuation">(</span><span class="token string">&#39;[&quot;batman&quot;, &quot;superman&quot;]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询Postgres数据库中的所有表信息（表名、备注）</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	relname <span class="token keyword">AS</span> tabname<span class="token punctuation">,</span>
	cast<span class="token punctuation">(</span> obj_description <span class="token punctuation">(</span> relfilenode<span class="token punctuation">,</span> <span class="token string">&#39;pg_class&#39;</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">COMMENT</span>
<span class="token keyword">FROM</span>
	pg_class c
<span class="token keyword">WHERE</span>
	relkind <span class="token operator">=</span> <span class="token string">&#39;r&#39;</span>
	<span class="token operator">AND</span> relname <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">&#39;pg_%&#39;</span>
	<span class="token operator">AND</span> relname <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">&#39;sql_%&#39;</span>
    <span class="token comment">-- AND relchecks=0 -- 过滤掉分表</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span>
	relname
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询Postgres数据库中的表字段名、类型、注释、注释是否为空</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	a<span class="token punctuation">.</span>attname <span class="token keyword">AS</span> NAME<span class="token punctuation">,</span>
	col_description <span class="token punctuation">(</span> a<span class="token punctuation">.</span>attrelid<span class="token punctuation">,</span> a<span class="token punctuation">.</span>attnum <span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">COMMENT</span><span class="token punctuation">,</span>
	format_type <span class="token punctuation">(</span> a<span class="token punctuation">.</span>atttypid<span class="token punctuation">,</span> a<span class="token punctuation">.</span>atttypmod <span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">type</span><span class="token punctuation">,</span>
	a<span class="token punctuation">.</span>attnotnull <span class="token keyword">AS</span> notnull
<span class="token keyword">FROM</span>
	pg_class <span class="token keyword">AS</span> c<span class="token punctuation">,</span>
	pg_attribute <span class="token keyword">AS</span> a
<span class="token keyword">WHERE</span>
	c<span class="token punctuation">.</span>relname <span class="token operator">=</span> <span class="token string">&#39;表名&#39;</span>
	<span class="token operator">AND</span> a<span class="token punctuation">.</span>attrelid <span class="token operator">=</span> c<span class="token punctuation">.</span>oid
	<span class="token operator">AND</span> a<span class="token punctuation">.</span>attnum <span class="token operator">&gt;</span><span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>UUID</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 不建议在高并发下使用，以下三个语句都可以生成</span>
<span class="token keyword">SELECT</span> uuid_in<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span> <span class="token operator">||</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span><span class="token punctuation">)</span>::cstring<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> uuid_in<span class="token punctuation">(</span>md5<span class="token punctuation">(</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span> <span class="token operator">||</span> clock_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span><span class="token punctuation">)</span>::cstring<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> md5<span class="token punctuation">(</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span> <span class="token operator">||</span> clock_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span><span class="token punctuation">)</span>::uuid<span class="token punctuation">;</span>
<span class="token comment">-- 去掉-，32位</span>
<span class="token keyword">SELECT</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span>md5<span class="token punctuation">(</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span> <span class="token operator">||</span> clock_timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span>::<span class="token keyword">text</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&#39;-&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>日期时间</strong></p>`,8),Rn={href:"https://www.postgresql.org/docs/current/functions-datetime.html",target:"_blank",rel:"noopener noreferrer"},Cn=t(`<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> to_timestamp<span class="token punctuation">(</span><span class="token string">&#39;2022-08-02 00:00:00&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;yyyy-MM-dd hh24:mi:ss&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">&#39;2022-08-02 23:59:59&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;yyyy-MM-dd HH24:mi:ss&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> to_char<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;yyyy-MM-dd HH24:mi:ss&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> date_trunc<span class="token punctuation">(</span><span class="token string">&#39;day&#39;</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> date_trunc<span class="token punctuation">(</span><span class="token string">&#39;day&#39;</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">interval</span> <span class="token string">&#39;1d&#39;</span> <span class="token operator">+</span> <span class="token keyword">interval</span> <span class="token string">&#39;6 hours&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- 获取周数</span>
<span class="token keyword">select</span> extract<span class="token punctuation">(</span>week <span class="token keyword">FROM</span> <span class="token keyword">timestamp</span> <span class="token string">&#39;2022-01-01&#39;</span><span class="token punctuation">)</span> week<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> date_part<span class="token punctuation">(</span><span class="token string">&#39;week&#39;</span><span class="token punctuation">,</span> <span class="token keyword">timestamp</span> <span class="token string">&#39;2022-01-01&#39;</span><span class="token punctuation">)</span> week<span class="token punctuation">;</span>
<span class="token comment">-- 月末</span>
<span class="token keyword">select</span> date_trunc<span class="token punctuation">(</span><span class="token string">&#39;month&#39;</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;1 months&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;-1 days&#39;</span><span class="token punctuation">;</span>
<span class="token comment">-- 遍历两个日期的每一天 https://stackoverflow.com/questions/6870499/generate-series-equivalent-in-mysql</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> generate_series<span class="token punctuation">(</span><span class="token string">&#39;2022-09-21 00:00:00&#39;</span>::<span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-09-22 00:00:00&#39;</span>::<span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span> <span class="token string">&#39;1 day&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 遍历两个日期的每小时</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> generate_series<span class="token punctuation">(</span><span class="token string">&#39;2022-09-21 00:00:00&#39;</span>::<span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span> <span class="token string">&#39;2022-09-22 00:00:00&#39;</span>::<span class="token keyword">TIMESTAMP</span><span class="token punctuation">,</span> <span class="token string">&#39;1 hour&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 每一天每一小时每一行的列数据</span>
<span class="token keyword">select</span>
    d::<span class="token keyword">date</span>::<span class="token keyword">text</span> <span class="token operator">||</span> <span class="token string">&#39; &#39;</span> <span class="token operator">||</span>
        to_char<span class="token punctuation">(</span>d::<span class="token keyword">time</span><span class="token punctuation">,</span> <span class="token string">&#39;HH24:MM:SS&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39; - &#39;</span> <span class="token operator">||</span>
        to_char<span class="token punctuation">(</span>d::<span class="token keyword">time</span> <span class="token operator">+</span> <span class="token keyword">interval</span> <span class="token string">&#39;1 hour&#39;</span> <span class="token operator">-</span> <span class="token keyword">interval</span> <span class="token string">&#39;1 second&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;HH24:MM:SS&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">hour</span>
<span class="token keyword">from</span>
    generate_series<span class="token punctuation">(</span>
       <span class="token punctuation">(</span><span class="token keyword">date</span> <span class="token string">&#39;2022-09-21&#39;</span><span class="token punctuation">)</span>::<span class="token keyword">timestamp</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token keyword">date</span> <span class="token string">&#39;2022-09-22&#39;</span><span class="token punctuation">)</span>::<span class="token keyword">timestamp</span><span class="token punctuation">,</span>
       <span class="token keyword">interval</span> <span class="token string">&#39;1 hour&#39;</span>
     <span class="token punctuation">)</span> <span class="token keyword">as</span> d
<span class="token comment">-- 计算时间差，实际时间不到1小时时，DATEDIFF会返回1，而DATE_PART返回0</span>
<span class="token keyword">SELECT</span> DATE_PART<span class="token punctuation">(</span><span class="token string">&#39;day&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2011-12-30 08:55&#39;</span>::<span class="token keyword">timestamp</span> <span class="token operator">-</span> <span class="token string">&#39;2011-12-30 09:05&#39;</span>::<span class="token keyword">timestamp</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">+</span> 
        DATE_PART<span class="token punctuation">(</span><span class="token string">&#39;hour&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2011-12-30 08:55&#39;</span>::<span class="token keyword">timestamp</span> <span class="token operator">-</span> <span class="token string">&#39;2011-12-30 09:05&#39;</span>::<span class="token keyword">timestamp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 提取days时结果是准确的；但提取hours的时候，出现的小时数没有考虑日期，最大23</span>
<span class="token keyword">SELECT</span> EXTRACT<span class="token punctuation">(</span>DAYS <span class="token keyword">FROM</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token string">&#39;2020-01-31 10:00:00&#39;</span>::<span class="token keyword">timestamp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>快速复制备份表</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">-- 表结构复制，包括索引和约束</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">schema</span><span class="token punctuation">.</span>table_name_bak <span class="token punctuation">(</span><span class="token operator">like</span> <span class="token keyword">schema</span><span class="token punctuation">.</span>table_name including <span class="token keyword">all</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sqlite3" tabindex="-1"><a class="header-anchor" href="#sqlite3" aria-hidden="true">#</a> SQLite3</h2>`,4),xn={href:"https://github.com/sqlite/sqlite",target:"_blank",rel:"noopener noreferrer"},In={href:"https://blog.csdn.net/hexingen/article/details/71577318",target:"_blank",rel:"noopener noreferrer"},Dn={href:"https://www.twle.cn/l/yufei/sqlite/sqlite-basic-index.html",target:"_blank",rel:"noopener noreferrer"},Bn={href:"https://www.runoob.com/sqlite/sqlite-tutorial.html",target:"_blank",rel:"noopener noreferrer"},Pn={href:"https://blog.csdn.net/feiyihexin/article/details/99728504",target:"_blank",rel:"noopener noreferrer"},Fn={href:"https://github.com/sqlitebrowser/sqlitebrowser",target:"_blank",rel:"noopener noreferrer"},jn={href:"https://github.com/sqlcipher",target:"_blank",rel:"noopener noreferrer"},Un={href:"https://github.com/utelle/wxsqlite3",target:"_blank",rel:"noopener noreferrer"},Hn={href:"https://sqljet.com",target:"_blank",rel:"noopener noreferrer"},Qn={href:"https://github.com/rqlite/rqlite",target:"_blank",rel:"noopener noreferrer"},Yn={href:"https://github.com/jlongster/absurd-sql",target:"_blank",rel:"noopener noreferrer"},Wn=t("<p><strong>连接符</strong></p><table><thead><tr><th>连接符</th><th>说明</th></tr></thead><tbody><tr><td>-</td><td>算术减法</td></tr><tr><td>!=</td><td>关系不等于</td></tr><tr><td>%</td><td>算术模量</td></tr><tr><td>&amp;</td><td>逻辑与</td></tr><tr><td>*</td><td>算术乘法</td></tr><tr><td>/</td><td>算术除法</td></tr><tr><td>|</td><td>逻辑或</td></tr><tr><td>||</td><td>字符串串联</td></tr><tr><td>+</td><td>算术加法</td></tr><tr><td>&lt;</td><td>关系小于</td></tr><tr><td>&lt;&lt;</td><td>按位右移</td></tr><tr><td>&lt;=</td><td>关系式小于或等于</td></tr><tr><td>&lt;&gt;</td><td>关系不等于</td></tr><tr><td>=</td><td>关系等于</td></tr><tr><td>==</td><td>关系等于</td></tr><tr><td>&gt;</td><td>关系大于</td></tr><tr><td>&gt;=</td><td>关系大于或等于</td></tr><tr><td>&gt;&gt;</td><td>按位左移</td></tr><tr><td>AND</td><td>逻辑与</td></tr><tr><td>GLOB</td><td>关系文件名匹配</td></tr><tr><td>IN</td><td>逻辑输入</td></tr><tr><td>LIKE</td><td>关系字符串匹配</td></tr><tr><td>OR</td><td>逻辑或</td></tr></tbody></table>",2);function zn(Jn,Vn){const o=l("router-link"),e=l("ExternalLinkIcon");return r(),i("div",null,[d,n("nav",k,[n("ul",null,[n("li",null,[a(o,{to:"#flag"},{default:p(()=>[s("Flag")]),_:1})]),n("li",null,[a(o,{to:"#事务"},{default:p(()=>[s("事务")]),_:1})]),n("li",null,[a(o,{to:"#数据库设计"},{default:p(()=>[s("数据库设计")]),_:1})]),n("li",null,[a(o,{to:"#oracle"},{default:p(()=>[s("ORACLE")]),_:1})]),n("li",null,[a(o,{to:"#postgresql"},{default:p(()=>[s("PostgreSQL")]),_:1})]),n("li",null,[a(o,{to:"#sqlite3"},{default:p(()=>[s("SQLite3")]),_:1})])])]),m,b,n("ul",null,[n("li",null,[n("a",h,[s("https://github.com/opengauss-mirror"),a(e)])]),n("li",null,[n("a",v,[s("https://github.com/MariaDB"),a(e)])]),n("li",null,[n("a",g,[s("https://github.com/percona/percona-server"),a(e)])]),n("li",null,[s("SQL代理 "),n("a",_,[s("https://github.com/sysown/proxysql"),a(e)])]),n("li",null,[s("sqlite克隆 "),n("a",w,[s("https://github.com/cstack/db_tutorial"),a(e)])]),n("li",null,[n("a",y,[s("http://www.h2database.com"),a(e)])]),n("li",null,[n("a",E,[s("https://sourceforge.net/projects/hsqldb"),a(e)]),n("ul",null,[n("li",null,[n("a",f,[s("http://hsqldb.org"),a(e)])])])]),n("li",null,[n("a",T,[s("https://github.com/FirebirdSQL/firebird"),a(e)])]),n("li",null,[n("a",q,[s("https://github.com/duckdb/duckdb"),a(e)])]),n("li",null,[n("a",A,[s("https://github.com/babelfish-for-postgresql"),a(e)])]),n("li",null,[n("a",S,[s("https://github.com/timescale/timescaledb"),a(e)])]),n("li",null,[n("a",N,[s("https://github.com/greenplum-db"),a(e)])])]),L,M,n("ul",null,[n("li",null,[n("a",O,[s("SQL递归查询知多少"),a(e)])]),n("li",null,[n("a",R,[s("SQL 的递归查询"),a(e)])])]),C,n("ul",null,[n("li",null,[n("a",x,[s("事务概念"),a(e)])]),n("li",null,[n("a",I,[s("事务隔离级别、脏读、不可重复读、幻读"),a(e)])]),n("li",null,[n("a",D,[s("事务的四大特性"),a(e)])])]),n("p",null,[n("strong",null,[s("遵循"),n("a",B,[s("ACID"),a(e)]),s("事务规则")])]),P,n("ul",null,[n("li",null,[n("a",F,[s("数据库设计-表结构的设计范式"),a(e)])]),n("li",null,[n("a",j,[s("数据库设计三大范式"),a(e)])])]),n("ul",null,[n("li",null,[n("a",U,[s("数据库分库分表Java实战经验总结"),a(e)])]),n("li",null,[n("a",H,[s("数据库分区"),a(e)])]),n("li",null,[n("a",Q,[s("数据库分区、分表、分库、分片"),a(e)])])]),Y,n("ul",null,[n("li",null,[n("a",W,[s("Oracle with as + /"),z,s("/ 优化"),a(e)])])]),J,n("ul",null,[n("li",null,[n("a",V,[s("如何在Oracle中一次执行多条sql语句"),a(e)])])]),G,n("ul",null,[n("li",null,[n("a",K,[s("SQL语句 存在就更新不存在就插入"),a(e)])]),n("li",null,[n("a",X,[s("merge into 的用法"),a(e)])])]),$,n("ul",null,[n("li",null,[n("a",Z,[s("Oracle两种临时表的创建及使用方法"),a(e)])])]),nn,n("ul",null,[n("li",null,[n("a",sn,[s("https://github.com/topics/postgrest"),a(e)])]),n("li",null,[n("a",an,[s("https://github.com/topics/postgresql"),a(e)])]),n("li",null,[n("a",en,[s("https://github.com/dhamaniasad/awesome-postgres"),a(e)])])]),n("ul",null,[n("li",null,[n("a",tn,[s("https://github.com/citusdata"),a(e)])]),n("li",null,[n("a",on,[s("https://github.com/postgres/postgres"),a(e)]),n("ul",null,[n("li",null,[n("a",pn,[s("Postgre系统目录"),a(e)])]),n("li",null,[n("a",ln,[s("连接字符串"),a(e)])]),n("li",null,[n("a",cn,[s("https://jdbc.postgresql.org"),a(e)])])])]),n("li",null,[n("a",rn,[s("https://github.com/postgrespro"),a(e)])]),n("li",null,[n("a",un,[s("https://github.com/pgpartman"),a(e)])]),n("li",null,[n("a",dn,[s("https://github.com/PostgREST/postgrest"),a(e)])]),n("li",null,[n("a",kn,[s("https://github.com/CrunchyData"),a(e)])]),n("li",null,[s("客户端 "),n("a",mn,[s("https://github.com/sosedoff/pgweb"),a(e)])]),n("li",null,[n("a",bn,[s("https://github.com/prest/prest"),a(e)])]),n("li",null,[n("a",hn,[s("https://github.com/alibaba/PolarDB-for-PostgreSQL"),a(e)])]),n("li",null,[s("扩展Rust开发框架 "),n("a",vn,[s("https://github.com/tcdi/pgx"),a(e)])])]),n("ul",null,[n("li",null,[s("文本搜索和分析 "),n("a",gn,[s("https://github.com/zombodb/zombodb"),a(e)])])]),n("ul",null,[n("li",null,[s("开发指南 "),n("a",_n,[s("https://github.com/dongxuyang1985/postgresql_dev_guide"),a(e)])]),n("li",null,[n("a",wn,[s("Postgresql库常用系统表"),a(e)])]),n("li",null,[n("a",yn,[s("PostgreSQL upsert(插入更新)教程"),a(e)])]),n("li",null,[s("递归查询 "),n("a",En,[s("http://postgres.cn/docs/14/queries-with.html"),a(e)])]),n("li",null,[n("a",fn,[s("PostgreSQL_树形结构的递归查询"),a(e)])]),n("li",null,[n("a",Tn,[s("postgresql递归查询"),a(e)])]),n("li",null,[n("a",qn,[s("PostgreSQL窗口函数"),a(e)])]),n("li",null,[n("a",An,[s("PostgreSQL 触发器"),a(e)])]),n("li",null,[n("a",Sn,[s("PostgreSQL的存储过程及基本使用"),a(e)])]),n("li",null,[n("a",Nn,[s("PostgreSQL事件触发器实战教程"),a(e)])]),n("li",null,[n("a",Ln,[s("pg12.5中分区表的一些操作"),a(e)])]),n("li",null,[n("a",Mn,[s("Postgresql12 分区表实例以及自动添加分区"),a(e)])])]),On,n("ul",null,[n("li",null,[n("a",Rn,[s("https://www.postgresql.org/docs/current/functions-datetime.html"),a(e)])])]),Cn,n("ul",null,[n("li",null,[n("a",xn,[s("https://github.com/sqlite/sqlite"),a(e)])])]),n("ul",null,[n("li",null,[n("a",In,[s("SQLite教程（内置日期和时间函数）"),a(e)])]),n("li",null,[n("a",Dn,[s("SQLite 教程"),a(e)])]),n("li",null,[n("a",Bn,[s("SQLite 教程"),a(e)])]),n("li",null,[n("a",Pn,[s("SQLite3 数据类型与亲和类型"),a(e)])])]),n("ul",null,[n("li",null,[n("a",Fn,[s("https://github.com/sqlitebrowser/sqlitebrowser"),a(e)])]),n("li",null,[s("加密SQLite "),n("a",jn,[s("https://github.com/sqlcipher"),a(e)])]),n("li",null,[n("a",Un,[s("https://github.com/utelle/wxsqlite3"),a(e)])]),n("li",null,[s("Java实现 "),n("a",Hn,[s("https://sqljet.com"),a(e)])]),n("li",null,[s("分布式关系数据库 "),n("a",Qn,[s("https://github.com/rqlite/rqlite"),a(e)])]),n("li",null,[n("a",Yn,[s("https://github.com/jlongster/absurd-sql"),a(e)])])]),Wn])}const Xn=c(u,[["render",zn],["__file","关系型数据库.html.vue"]]);export{Xn as default};
